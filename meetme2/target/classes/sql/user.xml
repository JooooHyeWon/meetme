<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Users">
	<select resultType="User" parameterType="String" id="idcheck">
		select * from mm_user where user_id = #{user_id}
	</select>
	
	<insert parameterType="User" id="insert">
		insert into mm_user 
		values((select nvl(max(user_num),0)+1 from mm_user), #{user_id},#{user_pass},#{user_name},#{user_email},#{user_gender},#{user_age},#{user_city}, #{user_save}, #{user_original})
	</insert>

	
	<select id="getSearchList" parameterType="map" resultType="user">
		select *
		from (select rownum rnum, b.*
			from (select * from mm_user
				where user_id != 'admin' 
				<if test="search_field!=null">
					and
					<choose>
						<when test="search_field=='user_id'">user_id</when>
						<when test="search_field=='user_name'">user_name</when>
						<when test="search_field=='user_age'">user_age</when>
						<when test="search_field=='user_gender'">user_gender</when>
						<when test="search_field=='user_city'">user_city</when>
					</choose>
					like #{search_word}
				</if>
				order by user_id)b
		)
		where rnum &gt;=#{start} and rnum &lt; = #{end}
	</select>
	
	<select id="searchcount" parameterType="map" resultType="int">
		select count(*) from mm_user
		where user_id!='admin'
		<if test="search_field!=null">
			and
			<choose>
				<when test="search_field=='user_id'">user_id</when>
				<when test="search_field=='user_name'">user_name</when>
				<when test="search_field=='user_age'">user_age</when>
				<when test="search_field=='user_gender'">user_gender</when>
				<when test="search_field=='user_city'">user_city</when>
			</choose>
			like #{search_word}
		</if>
	</select>
	
	<update id="update" parameterType="user">
		update mm_user
		set 
			user_pass=#{user_pass},
			user_name=#{user_name},
			user_age=#{user_age},
			user_gender=#{user_gender},
			user_email=#{user_email},
			user_city=#{user_city},
			user_image=#{user_image}
		where user_id=#{user_id}
	</update>
	
	<delete id="delete" parameterType="String">
		delete from mm_user where user_id=#{user_id}
	</delete>
	
	<insert id="categoryInsert" parameterType="Map">
		insert into user_user_interests
		values(#{user_num}, 
		<foreach item="item" index="index" collection="java.util.List">
			#{item.category_num})
		</foreach>
	</insert>
	
</mapper>


