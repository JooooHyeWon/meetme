<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Events">

	<select id="getCategory" resultMap="getCat">
		select * from MM_CATEGORY
	</select>

	<resultMap type="map" id="getCat">
		<result column="CATEGORY_NUM" property="CATEGORY_NUM" />
		<result column="CATEGORY_NAME" property="CATEGORY_NAME" />
	</resultMap>

	<select id="getIntrestingEvent" parameterType="String"
		resultType="event">
		select * from MM_EVENT order by EVENT_DATE
	</select>

	<select id="getDetail" resultType="Event">
		select * from MM_EVENT where
		EVENT_NUM = #{event_num}
	</select>

	<select id="search" parameterType="map" resultType="event">
		select * from MM_EVENT
		<where>
			<if test="keyword!='%null%'">
				upper(EVENT_TITLE) like upper(#{keyword}) OR
				upper(EVENT_CONTENT) like upper(#{keyword})
				OR upper(EVENT_LOCATION) like upper(#{keyword})
			</if>
			<if test="category!='0'">
				AND CATEGORY_NUM= #{category}
			</if>
			<![CDATA[
			AND EVENT_DATE >= TO_DATE(#{dateStart,jdbcType=DATE} , 'YYYY-MM-DD HH24:MI:SS')
			AND EVENT_DATE <= TO_DATE(#{dateEnd,jdbcType=DATE} , 'YYYY-MM-DD HH24:MI:SS')
			]]>
		</where>
	</select>

	<select id="searchHash" parameterType="map" resultType="event">
		select DISTINCT e.* from MM_EVENT e join MM_HASHTAG_USE u
		on(e.EVENT_NUM = u.EVENT_NUM)
		WHERE U.HASHTAG_NUM = #{hashtag}
		<![CDATA[
		AND e.EVENT_DATE >= TO_DATE(#{dateStart,jdbcType=DATE} , 'YYYY-MM-DD HH24:MI:SS')
		AND e.EVENT_DATE <= TO_DATE(#{dateEnd,jdbcType=DATE} , 'YYYY-MM-DD HH24:MI:SS')
		]]>
	</select>

	<select id="searchDate" parameterType="map" resultType="event">
		select DISTINCT e.* from MM_EVENT e join MM_HASHTAG_USE u
		on(e.EVENT_NUM = u.EVENT_NUM)
		WHERE
		<![CDATA[
		e.EVENT_DATE >= TO_DATE(#{dateStart,jdbcType=DATE} , 'YYYY-MM-DD HH24:MI:SS')
		AND e.EVENT_DATE <= TO_DATE(#{dateEnd,jdbcType=DATE} , 'YYYY-MM-DD HH24:MI:SS')
		]]>
	</select>
</mapper>